{"version":3,"file":"reactivity.global.js","sources":["../../shared/src/index.ts","../src/effect.ts","../src/basehandler.ts","../src/reactive.ts","../src/ref.ts","../src/computed.ts"],"sourcesContent":["export function isObject(val) {\r\n    return typeof val === 'object' && val != null\r\n}\r\n\r\nexport const extend = Object.assign\r\n\r\nexport function hasChange(oldValue, newValue) {\r\n    return oldValue !== newValue\r\n}\r\n\r\nexport let isIntegerKey = (key) => {\r\n    return parseInt(key) + '' === key\r\n}\r\n\r\nexport let isArray = Array.isArray;\r\n\r\nexport let hasOwn = (target, key) => Object.prototype.hasOwnProperty.call(target, key)","import { isArray, isIntegerKey } from \"@vue/shared\";\r\n\r\nexport function effect(fn, options: any = {}) {\r\n    const effect = createReactiveEffect(fn, options)\r\n    if (!options.lazy) {\r\n        effect()\r\n    }\r\n    return effect;  // 返回响应式的effect\r\n}\r\n\r\nlet activeEffect;\r\nlet effectStack = [];\r\nlet id = 0;\r\n\r\nfunction createReactiveEffect(fn, options) {\r\n    const effect = function reactvieEffect() {\r\n        try {\r\n            effectStack.push(effect);\r\n            activeEffect = effect;\r\n            return fn()\r\n        } finally {\r\n            effectStack.pop()\r\n            activeEffect = effectStack[effectStack.length - 1]\r\n        }\r\n    }\r\n\r\n    effect.id = id++;\r\n    effect.__isEffect = true;\r\n    effect.options = options;\r\n    effect.deps = [];  // 用来收集依赖了那些属性\r\n    return effect;\r\n}\r\n\r\nconst targetMap = new WeakMap()\r\n\r\nexport function track(target, type, key) {\r\n    if (activeEffect == undefined) {\r\n        // 用户只是进行取值操作，而且这个 值不是在effect中使用的什么都不用收集\r\n        return\r\n    }\r\n\r\n    let depsMap = targetMap.get(target);\r\n    if (!depsMap) {\r\n        targetMap.set(target, (depsMap = new Map()))\r\n    }\r\n\r\n    let dep = depsMap.get(key)\r\n    if (!dep) {\r\n        depsMap.set(key, (dep = new Set()))\r\n    }\r\n\r\n    if (!dep.has(activeEffect)) {\r\n        dep.add(activeEffect)\r\n    }\r\n\r\n\r\n}\r\n\r\nexport function trigger(target, type, key, newValue?, oldValue?) {\r\n    // 去映射表里找属性对应的effect，让他重新执行\r\n    const depsMap = targetMap.get(target);\r\n    if (!depsMap) return // 只是修改了属性，没有在effect中使用\r\n\r\n    const effectsSet = new Set();\r\n    // 如果同时又多个，依赖的effect是同一个，还有set做一个过滤\r\n    const add = (effectAdd) => {\r\n        if (effectAdd) {\r\n            effectAdd.forEach(effect => {\r\n                effectsSet.add(effect)\r\n            });\r\n        }\r\n    }\r\n\r\n\r\n\r\n    // arr = [1,2,3]\r\n    // arr.length = 1\r\n    // arr.push(4)\r\n    // 1. 如果更改了数组的长度，小于依赖收集的长度，要触发重新渲染\r\n    // 2. 如果调用了push方法，或者其他新增数组的方法(必须能改变数组的长度)，也触发更新\r\n\r\n    if (isArray(target) && key === 'length') {\r\n        depsMap.forEach((dep, key) => {\r\n            if (key > newValue || key === 'length') {\r\n                add(dep);  // 更改了数组的长度，比收集到的属性值小\r\n            }\r\n        })\r\n    } else {\r\n        add(depsMap.get(key))\r\n        switch (type) {\r\n            case 'add':\r\n                if (isArray(target) && isIntegerKey(key)) {\r\n                    // 增加属性，需要触发length 的依赖属性\r\n                    add(depsMap.get('length'))\r\n                }\r\n        }\r\n    }\r\n\r\n\r\n    effectsSet.forEach((effect: any) => {\r\n        if (effect.options.schedular) {\r\n            effect.options.schedular(effect)\r\n        } else {\r\n            effect()\r\n        }\r\n    })\r\n}","import { extend, hasChange, hasOwn, isArray, isIntegerKey, isObject } from \"@vue/shared\";\r\nimport { track, trigger } from \"./effect\";\r\nimport { reactive, readonly } from \"./reactive\";\r\n\r\nfunction createGetter(isReadonly = false, shallow = false) {\r\n    // vue3针对的是对象进行劫持，不用改写原来的对象，如果是嵌套，当取值的时候才会代理\r\n    // vue2 针对的是属性劫持，改写了原来的对象，一上来就递归的\r\n    /**\r\n     * target 原来的对象\r\n     * key 设置的属性值\r\n     * receiver 代理对象\r\n     */\r\n    return function get(target, key, receiver) {\r\n        const res = Reflect.get(target, key, receiver)\r\n\r\n        if (!isReadonly) {\r\n            // console.log('收集当前属性，如果这个属性变化了，稍候进行视图更新')\r\n            track(target, 'get', key)\r\n        }\r\n\r\n        //  \r\n        if (shallow) {\r\n            return res\r\n        }\r\n\r\n        if (isObject(res)) {\r\n            // 懒递归 当我们取值的时候才会去做递归代理，如果不取值，默认代理一层\r\n            return isReadonly ? readonly(res) : reactive(res)\r\n\r\n        }\r\n        return res;\r\n    }\r\n}\r\n\r\nfunction createSetter(shallow = false) {\r\n    // 数组新增的时候，触发了两次set，1. 新增了一项，同时更改了长度。2.因为更改了长度，再次触发了set（第二次的触发时无意义的）\r\n    return function set(target, key, value, receiver) {\r\n        const oldValue = target[key];\r\n\r\n        // 设置属性，可能之前有，也有可能之前没有（新增和修改）\r\n\r\n        /**\r\n         * 如果判断数组是新增还是修改\r\n         * 1. 是数组\r\n         * 2. 修改的key是数字\r\n         * 3. key的值小于length\r\n         * 为修改\r\n         */\r\n\r\n        let hasKey = isArray(target) && isIntegerKey(key) ? Number(key) < target.length : hasOwn(target, key)\r\n\r\n        const res = Reflect.set(target, key, value, receiver)\r\n\r\n        if (!hasKey) {\r\n            console.log('新增')\r\n            trigger(target, 'add', key, value)\r\n        } else if (hasChange(oldValue, value)) {\r\n            console.log('修改')\r\n            trigger(target, 'set', key, value, oldValue)\r\n        }\r\n        return res;  // 返回是否设置成功\r\n    }\r\n}\r\n\r\nconst get = createGetter();\r\nconst shallowGet = createGetter(false, true)\r\nconst readonlyGet = createGetter(true)\r\nconst shallowReadonlyGet = createGetter(true, true)\r\n\r\nconst set = createSetter()\r\nconst shallowSet = createSetter(true)\r\n\r\nexport const mutableHandler = {\r\n    set: set,\r\n    get: get,\r\n}\r\n\r\nexport const shallowReactiveHandler = {\r\n    set: shallowSet,\r\n    get: shallowGet\r\n\r\n}\r\n\r\nconst readonlySet = {\r\n    set(target, key) {\r\n        console.warn(`cannot set ${JSON.stringify(target)} on key '${key}' failed`)\r\n    }\r\n}\r\n\r\nexport const readonlyHandler = extend({\r\n    get: readonlyGet\r\n}, readonlySet)\r\n\r\nexport const shallowReadonlyHandler = extend({\r\n    get: shallowReadonlyGet\r\n}, readonlySet)\r\n","import { isObject } from \"@vue/shared\"\r\nimport { mutableHandler, readonlyHandler, shallowReactiveHandler, shallowReadonlyHandler } from \"./basehandler\"\r\n\r\n\r\n\r\n// 是否是浅的，默认时深度\r\n// 是否为只读，默认为否\r\n\r\nexport function reactive(target) {\r\n    return createReactiveObject(target, false, mutableHandler)\r\n}\r\n\r\nexport function shallowReactive(target) {\r\n    return createReactiveObject(target, false, shallowReactiveHandler)\r\n}\r\n\r\nexport function readonly(target) {\r\n    return createReactiveObject(target, true, readonlyHandler)\r\n}\r\n\r\nexport function shallowReadonly(target) {\r\n    return createReactiveObject(target, true, shallowReadonlyHandler)\r\n}\r\n\r\n/**\r\n * \r\n * @param target 创建代理对象目标\r\n * @param isReadonly 是否为只读\r\n * @param baseHandler 针对不同的方法创建不同的代理对象\r\n */\r\n\r\n// weakMap(key只能时对象) \r\nconst reactiveMap = new WeakMap();  // 目的是添加缓存\r\nconst readonlyMap = new WeakMap();\r\nfunction createReactiveObject(target, isReadonly, baseHandler) {\r\n    if(!isObject(target)){\r\n        return target\r\n    }\r\n    // 代理缓存\r\n    let proxyMap = isReadonly ? readonlyMap : reactiveMap;\r\n\r\n    const existProxy = proxyMap.get(target)\r\n    if(existProxy){\r\n        return existProxy; // 如果\r\n    }\r\n    // 如果是对象，就做一个代理\r\n    const proxy = new Proxy(target, baseHandler);\r\n    proxyMap.set(target, proxy)\r\n    return proxy\r\n}","import { hasChange, isArray, isObject } from \"@vue/shared\";\r\nimport { track, trigger } from \"./effect\";\r\nimport { reactive } from \"./reactive\";\r\n\r\nexport function ref(value) {\r\n    // 把普通值变成一个引用类型，让一个普通值也具备响应式的能力\r\n    return createRef(value)\r\n}\r\n\r\nexport function shallowRef(value) {\r\n    return createRef(value, true)\r\n}\r\n\r\nconst convert = (v) => isObject(v) ? reactive(v) : v;\r\n\r\n// ts 中实现类的话，私有属性必须先声明才能使用\r\nclass RefImpl {\r\n    public _value;\r\n    constructor(public rawValue, public shallow) {\r\n        this._value = shallow ? rawValue : convert(rawValue)\r\n    }\r\n\r\n    get value() {\r\n        // 收集依赖\r\n        track(this, 'get', 'value')\r\n        return this._value\r\n    }\r\n\r\n    set value(newValue) {\r\n        // 触发更新\r\n        if (hasChange(newValue, this.rawValue)) {\r\n            this.rawValue = newValue;\r\n            this._value = this.shallow ? newValue : convert(newValue)\r\n\r\n            trigger(this, 'set', 'value', newValue)\r\n        }\r\n    }\r\n}\r\n\r\nfunction createRef(value, shallow = false) {\r\n    return new RefImpl(value, shallow);  // 借助类的属性访问器\r\n}\r\n\r\nclass ObjectRefImpl {\r\n    public __v_isRef = true;\r\n    constructor(public target, public key) {\r\n\r\n    }\r\n    get value() {\r\n        return this.target[this.key]\r\n    }\r\n    set value(newValue) {\r\n        this.target[this.key] = newValue\r\n    }\r\n}\r\n\r\nexport function toRef(target, key) {\r\n    return new ObjectRefImpl(target, key)\r\n}\r\n\r\n\r\nexport function toRefs(target, key) {\r\n    const res = isArray(target) ? new Array(target.length) : {}\r\n    for (let key in target) {\r\n        res[key] = toRef(target, key)\r\n    }\r\n    return res;\r\n}","import { isObject } from \"@vue/shared\";\r\nimport { effect, track, trigger } from \"./effect\";\r\n\r\nclass ComputedRefImpl {\r\n    public effect;\r\n    public _value;\r\n    public _dirty = true;\r\n    constructor(public getter, public setter) {\r\n        // 返回effect的执行权限\r\n        // 传入了schedular 后，下次数据更新，原则上应该让effec重新执行，下次更新会调用schedular\r\n        this.effect = effect(getter, {\r\n            lazy: true, schedular: (effect) => {\r\n                if (!this._dirty) {\r\n                    // 用户修改了依赖的属性\r\n                    this._dirty = true;\r\n                    trigger(this, 'get', 'value')\r\n                }\r\n            }\r\n        })\r\n    }\r\n\r\n    get value() {\r\n        if (this._dirty) {\r\n            this._value = this.effect()\r\n            this._dirty = false;\r\n        }\r\n        // 收集计算属性的依赖\r\n        track(this, 'get', 'value')\r\n        return this._value\r\n    }\r\n\r\n    set value(newValue) {\r\n        // 当用户给计算属性设置值时会触发，set方法，此时调用计算属性的setter\r\n        this.setter(newValue)\r\n    }\r\n}\r\n\r\nexport function computed(getterOrOptions) {\r\n    let getter;\r\n    let setter;\r\n\r\n    if (isObject(getterOrOptions)) {\r\n        getter = getterOrOptions.get;\r\n        setter = getterOrOptions.set;\r\n    } else {\r\n        getter = getterOrOptions;\r\n        setter = () => {\r\n            console.log(`computed no setter`)\r\n        }\r\n    }\r\n\r\n    return new ComputedRefImpl(getter, setter)\r\n}"],"names":[],"mappings":"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"}